---
name: task-manager
description: Prowl 캘린더 태스크 관리 (생성/조회/수정/삭제)
---

# Task Manager

`~/prowl-task-calendar/` 폴더의 태스크를 생성, 조회, 수정, 삭제하는 통합 관리 커맨드입니다.

## 사용법

```
/task-manager 오늘 일정             ← 조회
/task-manager 내일 회의 추가         ← 추가
/task-manager 완료 <id>            ← 완료 처리
/task-manager 삭제 <id>            ← 삭제
/task-manager 수정 <id> 새 제목     ← 수정
```

## 명령 파싱 규칙

사용자 입력에서 첫 번째 키워드로 동작을 결정합니다:

| 키워드 | 동작 | 예시 |
|--------|------|------|
| `오늘`, `내일`, `이번주`, `all` | 조회 | `/task-manager 오늘` |
| `추가`, `등록`, `생성` | 추가 | `/task-manager 추가 내일 회의` |
| `완료`, `체크`, `done` | 완료 처리 | `/task-manager 완료 mlp0qhj` |
| `삭제`, `제거`, `delete` | 삭제 | `/task-manager 삭제 mlp0qhj` |
| `수정`, `변경`, `edit` | 수정 | `/task-manager 수정 mlp0qhj 새 제목` |

**첫 번째 키워드가 없거나 날짜 표현이면 조회로 처리합니다.**

---

# 1. 조회 (List)

## 사용법

```
/task-manager 오늘              ← 오늘 태스크만
/task-manager 내일              ← 내일 태스크만
/task-manager 이번주            ← 이번 주 (월~일)
/task-manager all               ← 전체 날짜
/task-manager                   ← 오늘 + 미완료 upcoming 태스크
```

## 실행 단계

1. `~/prowl-task-calendar/` 폴더에서 `YYYY-MM-DD.json` 파일들을 읽기
2. 인자에 따라 날짜 범위 필터링
3. 아래 출력 형식으로 표시

## 출력 형식

날짜별로 그룹핑하여 테이블 형태로 표시합니다:

```markdown
## 2026-02-15 (토) — 오늘

| 상태 | 제목 | 우선순위 | 시간 | 카테고리 | 설명 |
|:---:|------|:--------:|:----:|----------|------|
| ✅ | ~~문서 작성~~ | low | 14:00 | - | - |
| ⬜ | 코드 리뷰 | high | 18:00 | #개발 | API 엔드포인트 검토 필요 |

## 2026-02-17 (월)

| 상태 | 제목 | 우선순위 | 시간 | 카테고리 | 설명 |
|:---:|------|:--------:|:----:|----------|------|
| ⬜ | 주간 회의 | high | 10:00 | #회의 | - |
| ✅ | ~~버그 수정~~ | medium | - | #개발 | - |
```

### 규칙

- **상태**: ✅ (완료), ⬜ (미완료)
- **제목**: 완료된 태스크는 ~~취소선~~
- **우선순위**: `high`, `medium`, `low`
- **시간**: dueTime이 있으면 표시, 없으면 `-`
- **카테고리**: 있으면 `#카테고리` 형태로 표시, 없으면 `-`
- **설명**: description이 있으면 표시, 없으면 `-`
- 날짜별로 그룹핑, 날짜 오름차순 정렬
- 태스크가 없는 날짜는 표시하지 않음
- 각 테이블은 날짜 제목 아래에 표시

## 날짜 키워드 파싱

| 키워드 | 의미 |
|--------|------|
| (없음) | 오늘 + 오늘 이후 미완료 |
| `오늘` | 오늘 날짜만 |
| `내일` | 내일 날짜만 |
| `모레` | 모레 날짜만 |
| `이번주` | 이번 주 월요일~일요일 |
| `다음주` | 다음 주 월요일~일요일 |
| `이번달` | 이번 달 전체 |
| `YYYY-MM-DD` | 특정 날짜 |
| `all` | 전체 |

## 요약 통계

목록 하단에 간단한 통계를 표시합니다:

```
---
총 5건 | 완료 2건 | 미완료 3건 (high 1, medium 1, low 1)
```

---

# 2. 추가 (Add)

## 사용법

```
/task-manager 추가 내일 오후 2시까지 코드 리뷰 완료 (high)
/task-manager 등록 2026-03-01 API 문서 작성
/task-manager 생성 오늘 회의 준비 자료 정리
/task-manager 추가              ← 인자 없이 실행하면 AskUserQuestion으로 질문
```

## 입력 파싱 규칙

사용자 입력에서 다음을 추출합니다:

| 필드 | 파싱 방법 | 기본값 | 필수 |
|------|-----------|--------|------|
| **제목** | 날짜/시간/우선순위/카테고리를 제외한 나머지 텍스트 | - | **필수** |
| **날짜** | "오늘", "내일", "모레", "YYYY-MM-DD" 등 | 오늘 | 선택 |
| **시간** | "오후 2시", "14:00", "1400" 등 | 없음 (종일) | 선택 |
| **우선순위** | `(high)`, `(medium)`, `(low)` 또는 `!높음`, `!보통`, `!낮음` | `medium` | 선택 |
| **카테고리** | `#카테고리명` | 없음 | 선택 |
| **설명** | 줄바꿈 이후 텍스트 | 없음 | 선택 |

## 필수 정보 누락 시 처리

**제목이 파싱되지 않는 경우** (빈 입력, 날짜/시간만 있는 경우 등), 반드시 `AskUserQuestion` 도구를 사용하여 누락 정보를 질문합니다.

### 질문 흐름

1. **제목 누락** → AskUserQuestion으로 제목 입력 요청 (자유 입력)
2. **날짜가 모호한 경우** (예: "다음주") → AskUserQuestion으로 구체적 날짜 선택지 제공
3. **우선순위를 명시하지 않은 경우** → 기본값 `medium` 사용 (질문 안 함)

**절대 텍스트로 "제목을 입력해주세요"라고 요청하지 마세요. 반드시 AskUserQuestion 도구를 사용하세요.**

## JSON 파일 형식

파일 경로: `~/prowl-task-calendar/YYYY-MM-DD.json`

```json
[
  {
    "id": "고유ID (timestamp+random)",
    "title": "태스크 제목",
    "description": "설명 (선택)",
    "dueTime": "HH:MM (선택)",
    "priority": "high | medium | low",
    "category": "카테고리 (선택)",
    "completed": false,
    "createdAt": "ISO 8601 현재 시각"
  }
]
```

## 실행 단계

1. 사용자 입력에서 날짜, 시간, 우선순위, 카테고리, 제목을 파싱
2. **제목이 없으면 AskUserQuestion으로 질문** (이 단계를 건너뛰지 않음)
3. 해당 날짜의 JSON 파일이 이미 있으면 읽어서 배열에 추가, 없으면 새 배열 생성
4. `~/prowl-task-calendar/YYYY-MM-DD.json`에 저장
5. 생성된 태스크를 사용자에게 확인 표시

## ID 생성

```
Date.now().toString(36) + Math.random().toString(36).substring(2, 6)
```

---

# 3. 완료 처리 (Complete)

## 사용법

```
/task-manager 완료 mlp0qhj           ← ID로 완료 처리
/task-manager 완료 코드 리뷰          ← 제목으로 검색해서 완료 처리
/task-manager 코드 리뷰 완료했어      ← 자연어로 완료 처리
/task-manager 체크 회의 준비          ← 동일
/task-manager done API 문서           ← 동일
```

## 실행 단계

### ID 방식 (기존)
1. 입력이 짧고 알파벳+숫자 조합(예: `mlp0qhj`)이면 ID로 처리
2. 모든 `YYYY-MM-DD.json` 파일에서 해당 ID를 가진 태스크를 검색
3. 찾으면 `completed: true`로 변경하고 파일 저장

### 제목 검색 방식 (신규)
1. 입력이 ID가 아니면 제목으로 처리
2. **오늘부터 과거 7일간**의 JSON 파일을 읽어서 **미완료 태스크만** 필터링
3. 각 태스크의 `title`과 입력된 텍스트의 유사도 계산:
   - 완전 일치 우선
   - 부분 문자열 포함 (예: "코드 리뷰"가 "코드 리뷰 완료"에 포함)
   - 단어 단위 매칭 (예: "코드"와 "리뷰" 모두 포함)
4. 유사도가 가장 높은 태스크들 선별:
   - **1개만** 찾으면 바로 완료 처리
   - **여러 개** 찾으면 AskUserQuestion으로 선택지 제공
   - **없으면** "유사한 태스크를 찾을 수 없습니다" 메시지
5. 성공 시 완료된 태스크 정보 표시

## 유사 태스크가 여러 개일 때 선택 예시

```json
{
  "questions": [{
    "question": "어떤 태스크를 완료 처리하시겠습니까?",
    "header": "태스크 선택",
    "options": [
      {"label": "코드 리뷰 (오늘)", "description": "- [ ] 코드 리뷰 (high) 18:00"},
      {"label": "코드 리뷰 준비 (어제)", "description": "- [ ] 코드 리뷰 준비 (medium)"}
    ],
    "multiSelect": false
  }]
}
```

## 출력 예시

```
✅ 태스크 완료 처리되었습니다!

- [x] ~~코드 리뷰~~ (high) 18:00
```

---

# 4. 삭제 (Delete)

## 사용법

```
/task-manager 삭제 mlp0qhj           ← ID로 삭제
/task-manager 삭제 회의 준비          ← 제목으로 검색해서 삭제
/task-manager 회의 준비 삭제          ← 자연어로 삭제
/task-manager 제거 API 문서           ← 동일
/task-manager delete 코드 리뷰        ← 동일
```

## 실행 단계

### ID 방식
1. 입력이 ID 형식이면 해당 ID를 가진 태스크를 검색

### 제목 검색 방식
1. 입력이 ID가 아니면 제목으로 처리
2. **오늘부터 과거 7일간**의 JSON 파일에서 태스크 검색 (완료/미완료 모두)
3. 유사도 계산 후 가장 유사한 태스크 선별
4. 여러 개면 AskUserQuestion으로 선택지 제공

### 공통 실행
1. 태스크를 찾으면 **삭제 전 반드시 AskUserQuestion으로 확인** 요청
2. 확인 후 배열에서 제거하고 파일 저장
3. 배열이 비어있으면 파일도 삭제
4. 찾지 못하면 "태스크를 찾을 수 없습니다" 메시지 표시

## 확인 예시

```json
{
  "questions": [{
    "question": "정말 이 태스크를 삭제하시겠습니까?\n\n- [ ] 코드 리뷰 (high) 18:00",
    "header": "삭제 확인",
    "options": [
      {"label": "삭제", "description": "태스크를 영구 삭제합니다"},
      {"label": "취소", "description": "삭제하지 않습니다"}
    ],
    "multiSelect": false
  }]
}
```

---

# 5. 수정 (Update)

## 사용법

```
/task-manager 수정 mlp0qhj 새로운 제목           ← ID로 제목 변경
/task-manager 수정 코드 리뷰 새로운 제목          ← 제목 검색 후 변경
/task-manager 변경 회의 준비 --priority high     ← 제목 검색 후 우선순위 변경
/task-manager edit API 문서 --time 14:00        ← 제목 검색 후 시간 변경
```

## ID vs 제목 검색

- 첫 번째 인자가 ID 형식(짧은 알파벳+숫자)이면 ID로 처리
- 그 외에는 제목으로 검색 (오늘부터 과거 7일간, 완료/미완료 모두)
- 여러 개 찾으면 AskUserQuestion으로 선택

## 지원 옵션

| 옵션 | 설명 | 예시 |
|------|------|------|
| (텍스트) | 제목 변경 | `수정 <id> 새 제목` |
| `--priority` | 우선순위 변경 | `--priority high` |
| `--time` | 시간 변경 | `--time 14:00` |
| `--date` | 날짜 이동 | `--date 2026-02-20` |
| `--category` | 카테고리 변경 | `--category #회의` |
| `--description` | 설명 변경 | `--description 새 설명` |

## 실행 단계

1. 모든 `YYYY-MM-DD.json` 파일에서 해당 ID를 가진 태스크를 검색
2. 찾으면 지정된 필드만 변경하고 파일 저장
3. `--date` 옵션으로 날짜를 변경하면 원본 파일에서 제거하고 새 날짜 파일로 이동
4. 찾지 못하면 "태스크를 찾을 수 없습니다" 메시지 표시
5. 성공 시 변경된 태스크 정보 표시

## 출력 예시

```
✏️  태스크가 수정되었습니다!

- [ ] 새로운 제목 (high) 14:00
```

---

## 주의사항

- 파일이 이미 존재하면 기존 태스크 배열에 **추가** (덮어쓰지 않음)
- JSON은 들여쓰기 2칸으로 포맷팅
- `~/prowl-task-calendar/` 폴더가 없으면 생성
- 사용자에게 선택/확인을 요청할 때는 **반드시 AskUserQuestion 도구 사용** (텍스트로 선택지 나열 금지)
- ID는 전체를 입력하지 않아도 되며, 앞부분 일부만으로 검색 가능 (예: `mlp0q`로 `mlp0qhj` 찾기)
